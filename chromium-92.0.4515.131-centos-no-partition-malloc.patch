diff --git a/third_party/blink/renderer/platform/exported/platform.cc b/third_party/blink/renderer/platform/exported/platform.cc
index 5e808a73..69d6947f 100644
--- a/third_party/blink/renderer/platform/exported/platform.cc
+++ b/third_party/blink/renderer/platform/exported/platform.cc
@@ -33,6 +33,7 @@
 #include <memory>
 
 #include "base/allocator/partition_allocator/memory_reclaimer.h"
+#include "base/partition_alloc_buildflags.h"
 #include "base/single_thread_task_runner.h"
 #include "base/threading/thread_checker.h"
 #include "base/threading/thread_task_runner_handle.h"
@@ -55,7 +56,9 @@
 #include "third_party/blink/renderer/platform/instrumentation/canvas_memory_dump_provider.h"
 #include "third_party/blink/renderer/platform/instrumentation/instance_counters_memory_dump_provider.h"
 #include "third_party/blink/renderer/platform/instrumentation/memory_pressure_listener.h"
+#if BUILDFLAG(USE_PARTITION_ALLOC)
 #include "third_party/blink/renderer/platform/instrumentation/partition_alloc_memory_dump_provider.h"
+#endif
 #include "third_party/blink/renderer/platform/instrumentation/tracing/memory_cache_dump_provider.h"
 #include "third_party/blink/renderer/platform/language.h"
 #include "third_party/blink/renderer/platform/scheduler/common/simple_thread_scheduler.h"
@@ -230,9 +233,11 @@ void Platform::InitializeMainThreadCommon(Platform* platform,
 
   DCHECK(!g_gc_task_runner);
   g_gc_task_runner = new GCTaskRunner(Thread::MainThread());
+#if BUILDFLAG(USE_PARTITION_ALLOC)
   base::trace_event::MemoryDumpManager::GetInstance()->RegisterDumpProvider(
       PartitionAllocMemoryDumpProvider::Instance(), "PartitionAlloc",
       base::ThreadTaskRunnerHandle::Get());
+#endif
   base::trace_event::MemoryDumpManager::GetInstance()->RegisterDumpProvider(
       FontCacheMemoryDumpProvider::Instance(), "FontCaches",
       base::ThreadTaskRunnerHandle::Get());
diff --git a/third_party/blink/renderer/platform/instrumentation/BUILD.gn b/third_party/blink/renderer/platform/instrumentation/BUILD.gn
index 814c58d2..b2bcc1bb 100644
--- a/third_party/blink/renderer/platform/instrumentation/BUILD.gn
+++ b/third_party/blink/renderer/platform/instrumentation/BUILD.gn
@@ -2,6 +2,7 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
+import("//base/allocator/allocator.gni")
 import("//third_party/blink/renderer/platform/platform.gni")
 
 blink_platform_sources("instrumentation") {
@@ -18,8 +19,6 @@ blink_platform_sources("instrumentation") {
     "instance_counters_memory_dump_provider.h",
     "memory_pressure_listener.cc",
     "memory_pressure_listener.h",
-    "partition_alloc_memory_dump_provider.cc",
-    "partition_alloc_memory_dump_provider.h",
     "resource_coordinator/document_resource_coordinator.cc",
     "resource_coordinator/document_resource_coordinator.h",
     "resource_coordinator/renderer_resource_coordinator.cc",
@@ -37,7 +36,17 @@ blink_platform_sources("instrumentation") {
     "use_counter.h",
   ]
 
-  deps = [ "//services/service_manager/public/cpp" ]
+  if (use_allocator == "partition") {
+    sources += [
+      "partition_alloc_memory_dump_provider.cc",
+      "partition_alloc_memory_dump_provider.h",
+    ]
+  }
+
+  deps = [
+    "//base/allocator:buildflags",
+    "//services/service_manager/public/cpp",
+  ]
   public_deps = [
     "//components/performance_manager/public/mojom:mojom_blink",
     "//third_party/blink/renderer/platform/heap:heap",
